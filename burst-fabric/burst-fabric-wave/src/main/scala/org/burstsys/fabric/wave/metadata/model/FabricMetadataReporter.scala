/* Copyright Yahoo, Licensed under the terms of the Apache 2.0 license. See LICENSE file in project root for terms. */
package org.burstsys.fabric.wave.metadata.model

import org.burstsys.vitals.reporter.VitalsReporter
import org.burstsys.vitals.reporter.metric.VitalsReporterByteOpMetric

private[fabric]
object FabricMetadataReporter extends VitalsReporter {

  final val dName: String = "fab-metadata"

  /////////////////////////////////////////////////////////////////////////////////////////////////////////////
  // private state
  /////////////////////////////////////////////////////////////////////////////////////////////////////////////

  private[this]
  val _domainLookupTally = VitalsReporterByteOpMetric("metadata_domain_lookup")

  private[this]
  val _viewLookupTally = VitalsReporterByteOpMetric("metadata_view_lookup")

  this += _domainLookupTally
  this += _viewLookupTally

  /////////////////////////////////////////////////////////////////////////////////////////////////////////////
  // LIFECYCLE
  /////////////////////////////////////////////////////////////////////////////////////////////////////////////

  override def sample(sampleMs: FabricGenerationClock): Unit = {
    super.sample(sampleMs)
  }

  /////////////////////////////////////////////////////////////////////////////////////////////////////////////
  // API
  /////////////////////////////////////////////////////////////////////////////////////////////////////////////

  final
  def recordDomainLookup(): Unit = {
    newSample()
    _domainLookupTally.recordOp()
  }

  final
  def recordViewLookup(): Unit = {
    newSample()
    _viewLookupTally.recordOp()
  }

  /////////////////////////////////////////////////////////////////////////////////////////////////////////////
  // REPORT
  /////////////////////////////////////////////////////////////////////////////////////////////////////////////

  final override
  def report: String = {
    if (nullData) return ""
    s"""|${_domainLookupTally.report}${_viewLookupTally.report}""".stripMargin
  }

}
